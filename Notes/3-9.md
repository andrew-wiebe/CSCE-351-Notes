direct map cache - number of ways or lines = 1

if number > 1 then it is that number ways associative 

Cache size = # sets x # of ways x # block size

Review Cache Memories (part 2)
---
___

What abt writing?
- multiple copies of data exist like on L1 and L2, Main memory and disk

what to do on a write hit
- write through (write immediately to memory)
- write-back (defer write to memory until replacement of line)
    - need a dirty bit (line different from memory or not)

Write miss
- write allocate (load into cache, update line in cache)
    - good if more writes to the location follow
- no write allocate (writes immediately to memory)

typically
- hit: write through + miss: no write allocate
- hit: write back + miss: write allocate


to measure performance of cache
- miss rate

miss rate
- typically 3-10% in L1
- can be smaller <1% for L2

hit time
- time to deliver a line in the cache to the processor
- typically 1-2 clock cycle for L1
- 5-20 clock cycles for L2

miss penalty
- additional time required because of a miss
    - 50-200 cycles for main memory

huge difference between a hit and a miss
- could be 100x if just l1 and main memory

99% hits is twice as good as 97%
- 97% hits: 1 cycle + 0.03 * 100 cycles = 4 cycles
- 99% hits: 1 cycle + 0.001 * 100 cycles = 2 cycles
this is why we use miss rate instead of hit rate

we try to have cache friendly code (think of the for loop thing from 231)

minimize the misses in the inner loops
- repeated references to variables are good(temporal locality)
- stride-1 refrence patterns are good(spatial locality)

how many bits for block offset, set index, and tax for a cache block that is 64 bytes?
---
`2^x = 64, x = 6`
so we know the block offset needs 6 bits
number of entries = size of cache / block size
`= 2^15 / 2^ 6 = 2^2 = 512 blocks`

how many sets?
`2^9 / 2^ 3 = 2^ 6 = 64 sets`
set index will include 6 bits
`15 (size of cache) - 12 (used bits)`


tag includes the leftover bits so it will be 3 bits

CACHE EXERCISES
---
___


memory accesses are to 1 byte words
physical addresses are 12 bits wide
the l1 d-cache is physically addressed and direct mapped with a 4-byte line and 16 total sets

2^x where x = the size of the physical address  = size of memory
2^12 = size for the memory



STEPS
1 convert hex address to binary
2 determine how many bits are needed for block offset, set and tag
3 partition the address into block offset, set, and tag
4 use the set info to access that cache, compare if the tag matchess
- yes use the block offset info to get the data
- no we have a cache miss

ex:
physical addresses are 12 bits side
the l1 d cache is physically addressed and 2 way set associative with 4 byte line and 16 entries

2 entries per set


